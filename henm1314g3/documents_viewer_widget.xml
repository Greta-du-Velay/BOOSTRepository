<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    
    <ModulePrefs title="Boost Viewer"
		description="View documents like videos or slides."
		author="Team Boost"
		author_email="henm1314g3@dbis.rwth-aachen.de"
		height="400">
  	<Require feature="opensocial-0.8" />
    <Require feature="openapp" />
    <OAuth>
		<Service name="openapp"                     
		    xmlns:openapp="http://www.role-project.eu/xml/openapp/opensocialext/" 
		    openapp:service="http://purl.org/role/terms/spaceService"
		    openapp:permitReadAppend="http://purl.org/role/terms/data">
			
		    <Request method="" url=""/>
			<Authorization url=""/>
			<Access method="" url=""/>
		</Service>
    </OAuth>
    </ModulePrefs>
    
    <Content type="html">
    <![CDATA[
		
		<!-- We use jQuery to manipulate DOM and jQuery-UI for the interface. -->
    	<script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/jquery-1.10.2.min.js" type="text/javascript"></script>
    	<script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/bootstrap.min.js" type="text/javascript"></script>
    	<script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/search_youtube.js" type="text/javascript"></script>
    	<script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/search_slideshare.js" type="text/javascript"></script>
    	<script src="https://apis.google.com/js/client.js?onload=onYouTubeClientLoad" type="text/javascript"></script>
    	<script src="http://dbis.rwth-aachen.de/gadgets/iwc/lib/iwc.js"></script>
    	<script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/linkify.js" type="text/javascript"></script>
    	<script type="text/javascript" src='http://www.scribd.com/javascripts/scribd_api.js'></script>

		<!-- Define CSS -->		
		<link href="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/css/bootstrap.min.css" rel="stylesheet">

		<!-- JavaScript Block -->
		<script>
			var iwcClient;
			
			gadgets.util.registerOnLoadHandler(init);
			
			function init(){
				iwcClient = new iwc.Client();
				iwcClient.connect(iwcCallback);
			}

			function publishSaveYoutubeVideoAsDocument(youtubeVideoData){
				var intent = {
					component: "",
					data: "",
					dataType: "text/json",
					flags :["PUBLISH_GLOBAL"],
					action: "SAVE_YOUTUBE_VIDEO_AS_DOCUMENT",
					extras: youtubeVideoData
				};

				iwcClient.publish(intent);
			}

			function iwcCallback(intent){
				if(intent.action == "SHOW_YOUTUBE_VIDEO"){
					showYoutubeVideo(intent.extras.id);
				}

				if(intent.action == "SHOW_SLIDESHARE_SLIDESHOW"){
					showSlideshareSlideshow(intent.extras.id);
				}

				if(intent.action == "SHOW_SCRIBD_DOCUMENT"){
					showScribdDocument(intent.extras.id, intent.extras.accessKey, intent.extras.description);
				}
			}

			function showYoutubeVideo(id){
				$("#content").empty();
				//Retrieve video data
				YouTubeSearch.getVideoDetails(id, function(videoDetails){
					var title = videoDetails.items[0].snippet.description;
					var description = videoDetails.items[0].snippet.description;
					var youtubeTemplate = 	"<div class='well'>" +
											"<center>" +
											"<div>" +
											"<iframe type='text/html' width='480' height='270' src='https://www.youtube.com/embed/" + id + "' " +
		                                    "frameborder='0' allowfullscreen></iframe>" +
		                                    "<p style='margin-top:5px;'>" +
		                                    "<button id='saveDocumentButton' type='button' class='btn btn-primary btn-xs'>Add to documents</button>" +
				                        	"</p>" +
				                        	"</div>" +
		                                    "</center>" +
				                        	"<h4>Description</h4>" +
				                        	"<p>" +
				                        		description.replace(/\n/g, "<br>").linkify() +
				                        	"</p>" +
				                        	"</div>";
				    $("#content").append(youtubeTemplate);
				    $("#saveDocumentButton").click(function(){
				    	var youtubeVideoData = {};
				    	youtubeVideoData.id = id;
				    	youtubeVideoData.title = title;
				    	youtubeVideoData.description = description;
				    	publishSaveYoutubeVideoAsDocument(youtubeVideoData);
				    });
				});
			}

			function showSlideshareSlideshow(id){
				$("#content").empty();
				SlideShareSearch.getSlideshowDetails(id, function(slideshowDetails){
					var description = slideshowDetails.Slideshow.Description;
					if(!description)
						description = "No description available.";
					var slideshowTemplate =	"<div class='well'>" +
											"<center>" +
											slideshowDetails.Slideshow.Embed +
		                                    "</center>" +
				                        	"<h4>Description</h4>" +
				                        	"<p>" +
				                        		description.replace(/\n/g, "<br>").linkify() +
				                        	"</p>" +
				                        	"</div>";
				    $("#content").append(slideshowTemplate);
				});
			}

			function showScribdDocument(id, accessKey, description){
				$("#content").empty();
				var scribdTemplate = 	"<div class='well'>" +
										"<div id='scribdContainer'>" +
	                                    "</div>" +
			                        	"<h4>Description</h4>" +
			                        	"<p>" +
			                        		description.replace(/\n/g, "<br>").linkify() +
			                        	"</p>" +
			                        	"</div>";
			    
			    $("#content").append(scribdTemplate);
			    var scribd_doc = scribd.Document.getDoc(id, accessKey);
				scribd_doc.addParam('jsapi_version', 2);
				scribd_doc.write('scribdContainer');
			}



		</script>

		<!-- HTML Block -->
		<div style="overflow-y: scroll; height:400px;">
		<div class="panel panel-primary">
			<div class="panel-heading">
		    	<h3 class="panel-title"><span class="glyphicon glyphicon-play-circle" style="margin-right:5px;"></span>Documents viewer</h3>
		  	</div>
		  	<div class="panel-body" id="content">
			</div>
		</div>
		</div>
	]]>
  </Content>
</Module>
