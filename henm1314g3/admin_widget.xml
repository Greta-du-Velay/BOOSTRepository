<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs
    title="Admin Widget"
    description="Manage your Repository."
    author="Team Boost"
    author_email="neulinger@dbis.rwth-aachen.de"
    height="400">
    <Require feature="opensocial-0.8" />
    <Require feature="openapp" />
    <OAuth>
    <Service name="openapp"                     
        xmlns:openapp="http://www.role-project.eu/xml/openapp/opensocialext/" 
        openapp:service="http://purl.org/role/terms/spaceService"
        openapp:permitReadAppend="http://purl.org/role/terms/data">
      
        <Request method="" url=""/>
      <Authorization url=""/>
      <Access method="" url=""/>
    </Service>
    </OAuth>
  </ModulePrefs>

  <Content type="html">
    <![CDATA[

    <!-- We use jQuery to manipulate DOM and Bootstrap for the interface. -->
      <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/bootstrap.min.js"></script>
   
    <script src="http://dbis.rwth-aachen.de/gadgets/iwc/lib/iwc.js"></script>
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/ladda/spin.min.js"></script>
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/ladda/ladda.min.js"></script>
            
    <!-- Managers for BCN and Employee related stuff -->
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/BCNManager.js"></script>
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/EmployeeManager.js"></script>
    <script src="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/js/ConfigManager.js"></script>


    <!-- Define CSS -->
   <link rel="stylesheet" href="http://127.0.0.1:8073/role/BOOSTRepository/henm1314g3/css/bootstrap.min.css">
 

    <!-- JavaScript Block -->
    <script>

    var space;
    var iwcClient;
    var bcnsList = new Array();
    var liList = new Array();
    var config;

    gadgets.util.registerOnLoadHandler(init);
 
    function init(){
          
        space = new openapp.oo.Resource(openapp.param.space());
        iwcClient = new iwc.Client();
        retrieveConfig(space, function(configObject){
          config = configObject; 
        });

      }

    function publishConfigChanged(configUri){
        var intent = {
          component: "",
          data: configUri,
          dataType: "text/json",
          flags :["PUBLISH_GLOBAL"],
          action: "CONFIG_CHANGE"
        };

        iwcClient.publish(intent);
      }
      

    $(document).ready(function(){

      $("#saveRepoButton").click(function(){

        config.useYouTube = $("#youTubeCheckBox").is(':checked');
        config.useSlideShare = $("#slideShareCheckBox").is(':checked');
        config.useScribd = $("#scribdCheckBox").is(':checked');
       // console.log(JSON.stringify(config));
        
        updateConfig(config, function(){
           publishConfigChanged(config.uri);
        });

       

      });


      $("#repoIDmenu").click(function() {
        $("#manageRepoModal").modal();

        if (config.useYouTube) {
        $("#youTubeCheckBox").prop('checked', true);
        console.log(config.useYouTube);
      };

        if (config.useSlideShare) {
        $("#slideShareCheckBox").prop('checked', true);
        console.log(config.useSlideShare);
      };

        if (config.useScribd) {
        $("#scribdCheckBox").prop('checked', true);
        console.log(config.useScribd);
      };

      });

      $("#keywordsIDmenu").click(function() {
        $("#addKeywordsModal").modal();
        $("#textInput").val('');
     }); 


      retrieveAllBcns(space, function(bcns){
            bcnsList = bcns;
            
            
            for(var i = 0; i < bcnsList.length; i++){
             var bcn = bcnsList[i];
             liList = bcn.learningIndicators;

          //    var test = bcn.addLIwithDescription("someGoal","someDescription");
         //    console.log(test);
             };
             keywordsModal();
          });

       
    });

    function keywordsModal() {

      var selectedLIName;
      var selectedGoalName;


      $("#bodyKeywordsModal").empty();

         /* Sort according priority index and name */

        bcnsList.sort(function(a, b){
          if (a.priority==b.priority) {if(a.name.toLowerCase() < b.name.toLowerCase()) return -1; else return 1;}
          if(a.priority > b.priority)  return -1; else return 1;
          
        });

        var template =  "<table width='100%'>" +
                  "<tr>" +
                  "<td><h5>Choose goal: </h5><h5 id='someGoal' style='color:#3677AF; font-weight:bold;'></h5></td>" +
                  "<td style='width:100px;' align='center'>" +
                  "<div id='goal-btn-group' class='btn-group'>" +
                    "</div>" +
                    "</td>" +
                "</tr>" +
                "<tr>" +
                "<td><h5>Choose learning indicator: </h5><h5 id='someLI' style='color:#3677AF; font-weight:bold;'></h5></td>" +
                "<td style='width:100px;' align='center'>" +
                     "<div id='li-btn-group' class='btn-group'>" +
                    "</div>" +
                    "</td>" +
                "</tr>" +
                "<tr>" +
                "<td colspan='2'><h5 id ='disabledText' class='hide'>Enter related description: </h5></td>" +
                "</tr>"+
                "<tr>" +
                "<td></td>" +
                "<td></td>" +
                "</tr>"+
                "<tr>" +
                "<td colspan='2'><textarea class='form-control hide' id='textInput' rows='3'></textarea></td>" +
                "</tr>" + 
                "</table>";

        var entry = $(template);
        var goalDropClass = $('<div id="goalDropClass" class="btn-group"></div>'); 
  

        var goalButton = $('<button type="button" class="btn btn-default dropdown-toggle li-btn" id="goalDropDown" data-toggle="dropdown"><span class="glyphicon glyphicon-chevron-down"></span></button>');
  
        
        goalDropClass.append(goalButton);
    
       
        var goalDropDownMenu = $('<ul class="dropdown-menu pull-right" role="menu" aria-labelledby="goalDropDown"></ul>');
    

        var goal;
   
        
        for(var i=0; i<bcnsList.length; i++) {
          var bcn = bcnsList[i];

          goal = $('<li role="presentation"> <a role ="menuitem" " href="#" tabindex="-1">'+bcn.name+'</a></li>');
          goalDropDownMenu.append(goal);
       }


    goalDropClass.append(goalDropDownMenu);
    

    entry.find("#goal-btn-group").append(goalDropClass);
     

    $("#bodyKeywordsModal").append(entry);

      


      var liDropClass = $('<div id="liDropClass" class="btn-group"></div>');
      var liButton = $('<button type="button" class="btn btn-default dropdown-toggle li-btn" id="liDropDown" data-toggle="dropdown"><span class="glyphicon glyphicon-chevron-down"></span></button>'); 
      liDropClass.append(liButton);
      var liDropDownMenu = $('<ul class="dropdown-menu pull-right" role="menu" aria-labelledby="liDropDown"></ul>');
      var learningIndicator;

       $('#goalDropClass li a').click(function()
    { 
      selectedGoalName = $(this).text();

     $('#someGoal').text(selectedGoalName);
     
      for(var i=0; i<bcnsList.length; i++) {
        if (bcnsList[i].name == selectedGoalName) {

            var temp = bcnsList[i].learningIndicators;

             for (var j=0; j<temp.length; j++) {
              var selectedLearningIndicator = temp[j];
              learningIndicator = $('<li role="presentation"> <a role ="menuitem" " href="#" tabindex="-1">'+selectedLearningIndicator.name+'</a></li>');
               liDropDownMenu.append(learningIndicator);

             }
          }
       }

       liDropClass.append(liDropDownMenu);
      entry.find("#li-btn-group").append(liDropClass); 

       $('#liDropClass li a').click(function()
          { 
            selectedLIName = $(this).text();
            $('#someLI').text(selectedLIName);
            $('#textInput').removeClass('hide');
            $('#disabledText').removeClass('hide');

           });

    });


      $("#saveButton").click(function(){

        var descriptionLI = $('#textInput').val();

        if (descriptionLI) {
     //     console.log(descriptionLI );
     //     $('#textInput').val('');

          for(var i=0; i<liList.length; i++) {
         
           if (liList[i].name == selectedLIName) {
          console.log("Selected LI" + liList[i].name);
          }
        }
      } else 
          {alert("Please enter description!")};
      
      });

    }
               
    </script>

    <!-- HTML Block -->

    <div style="overflow-y: scroll; height:400px;">
      <div class="panel panel-primary">
   
        <div class="panel-heading">
            <h3 class="panel-title">Control Boost Widgets</h3>
        </div>

        <div class="list-group list-group-flush">
          <a href="#" id="repoIDmenu" class="list-group-item">
            <div><span class="glyphicon glyphicon-check pull-right" style="margin-right:5px;"></span>
               <h5 class="list-group-item-heading">Manage Learning Repositories</h5>
               <h6 class="list-group-item-text">Allow or restrict access to the learning repositories</h6>
            </div>
          </a>
          <a href="#" id="keywordsIDmenu" class="list-group-item">
            <div><span class="glyphicon glyphicon-list-alt pull-right" style="margin-right:5px;"></span>
               <h5 class="list-group-item-heading"> Assign description to LIÂ´s </h5>      
              <h6 class="list-group-item-text">Provide description to the learning indicators to help your employees search for the relevant content </h6>       
            </div>
            
          </a>
         
         
        </div>
 
      </div>
    </div>

    <!-- Modal to manage repositories -->

      <div class="modal fade" id="manageRepoModal" >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h5 class="modal-title">Choose repositories that you would like to access:</h5>
            </div>
            <div class="modal-body">
               <li class="list-group-item">
            <div class="checkbox">
                <label>
                  <input id="youTubeCheckBox" type="checkbox"> YouTube
                </label>
           </div>
          </li>
          <li class="list-group-item">
            <div class="checkbox">
                <label>
                  <input id="slideShareCheckBox" type="checkbox"> SlideShare
                </label>
            </div>
           </li>
          <li class="list-group-item">
            <div class="checkbox">
                <label>
                  <input id="scribdCheckBox" type="checkbox"> Scribd
                </label>
            </div></li>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button id="saveRepoButton" type="button" class="btn btn-primary"  data-dismiss="modal">Save changes</button>
              
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->


      <!-- Modal to manage keywords -->

      <div class="modal fade" id="addKeywordsModal"> 
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Assign description to learning indicators:</h4>
                  </div>
                  <div class="modal-body" id="bodyKeywordsModal">


                  </div>
                  <div class="modal-footer">
                    <div class="form-actions">
                       <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="submit" id="saveButton" class="btn btn-primary">Save</button>
                    </div>
                  </div><!-- /.modal-footer -->
              </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->

    ]]>
  </Content>
</Module>